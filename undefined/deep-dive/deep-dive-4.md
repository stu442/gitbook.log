# 모던 자바스크립트 Deep Dive 스터디 4주차

## 23장 실행 컨텍스트

### 23.1 소스코드의 타입

* 4가지 타입의 소스코드는 실행 컨텍스트를 생성한다.
  * 전역 코드
    * 전역 변수 관리를 위해 전역 스코프를 생성
    * var 키워드 전역 변수
    * 함수 선언문
  * 함수 코드
    * 지역 스코프를 생성, 지역 변수, 매개변수, arguments 객체 관리
  * eval 코드
    * strict mode 에서 독자적인 스코프 생성
  * 모듈 코드
    * 모듈 스코프 생성

### 23.2 소스코드의 평가와 실행

* 자바스크립트 엔진은 소스코드를 2개 과정으로 나눠 처리
  * 소스코드의 평가
    * 실행 컨텍스트 생성, 변수, 함수 등의 선언문만 먼저 실행
    * 식별자를 스코프에 등록!
  * 소스코드의 실행
    * 선언문을 제외한 소스코드가 순차 실행 -> 런타임의 실행

### 23.3 실행 컨텍스트의 역할

1. 전역 코드 평가
   1. 선언문만 먼저 실행
   2. 전역 변수 선언문과 함수 선언문이 먼저 실행
   3. 전역 변수와 전역 함수가 실행 컨텍스트가 관리하는 전역 스코프에 등록
   4. var 키워드로 선언된 전역 변수와 함수 선언문 -> 전역 객체의 프로퍼티와 메서드가 된다.
2. 전역 코드 실행
   1. 런타임 시작!
   2. 함수 호출 시 전역 코드 실행 일시 중단,
   3. 함수 내부로 진입
3. 함수 코드 평가
   1. 내부 문들 실행 전, 평가 시작
   2. arguments 객체 생성, 지역 스코프에 등록
   3. this 바인딩 결정
4. 함수 코드 실행
   1. 런타임 시작!
   2. console.log 메서드 호출을 위해 console을 스코프 체인을 통해 검색
   3. 전역 스코프를 통해 검색 완료!
   4. log 프로퍼티를 객체의 프로토타입 체인을 통해 검색

> 실행 컨텍스트는 소스코드 실행을 위해 필요한 환경 제공, 실행 결과를 관리하는 영역

### 23.4 실행 컨텍스트 스택

* 실행 컨텍스트는 스택으로 관리된다. (콜스택이라고도 한다.)
* 실행 컨텍스트 스택의 최상위 존재하는 실행 컨텍스트는 언제나 현재 실행 중인 코드의 실행 컨텍스트다.

### 23.5 렉시컬 환경

* 렉시컬 환경은 식별자와 식별자에 바인딩된 값, 상위 스코프에 대한 참조를 기록하는 자료구조 -> 실행 컨텍스트를 구성하는 컴포넌트
* 실행 컨텍스트는 코드 _실행 순서_ 관리
* 렉시컬 환경은 _스코프와 식별자_ 관리
* 렉시컬 환경은 키와 값을 갖는 객체 형태의 스코프를 생성
  * 식별자 = 키
* 렉시컬 환경
  * 환경 레코드 (EnvironmentRecord)
  * 외부 렉시컬 환경에 대한 참조 (OuterLexicalEnvironmentReference)

### 23.6 실행 컨텐스트의 생성과 식별자 검색 과정

* 전역 객체 생성
* 전역 코드 평가
* foo 함수 코드 평가
* foo 함수 코드 실행
* bar 함수 코드 평가
* bar 함수 코드 실행
* bar 함수 코드 실행 종료
* foo 함수 코드 실행 종료
* 전역 코드 실행 종료

#### 23.6.1 전역 객체 생성

* 전역 객체는 평가 전에 생성된다.
* 전역 객체도 Object.prototype을 상속받는다.

Q: 잠깐, 그럼 프로토타입은 언제 초기화되는가?\
A:

* JS 엔진 초기화
  * 이때, 내장 객체 생성
  * Object.prototype 생성된다.
* 전역 객체 생성
* 전역 코드 평가

순서대로 실행 된다.

#### 23.6.2 전역 코드 평가

1. 전역 실행 컨텍스트 생성
2. 전역 렉시컬 환경 생성
   1. 전역 환경 레코드 생성
      1. 객체 환경 레코드 생성
      2. 선언적 환경 레코드 생성
   2. this 바인딩
   3. 외부 렉시컬 환경에 대한 참조 결정

#### 23.6.3 전역 코드 실행

#### 23.6.4 foo 함수 코드 평가

#### 23.6.5 foo 함수 코드 실행

#### 23.6.6. bar 함수 코드 평가

#### 23.6.7 bar 함수 코드 실행

#### 23.6.8 bar 함수 코드 실행 종료

#### 23.6.9 foo 함수 코드 실행 종료

#### 23.6.10 전역 코드 실행 종료

### 23.7 실행 컨텍스트와 블록 레벨 스코프

* var 키워드로 선언 시, 함수 레벨 스코프
* let, const 선언 시, 블록 레벨 스코프
